# Last Updated: 2026-02-17 [Stash Override v1.75]
# ç§»æ¤è‡ª PC ç«¯ Mihomo_Override.js v1.89
# å¼•ç”¨é“¾æ¥: https://raw.githubusercontent.com/TamperAcc/Clash/main/StashSystem.yaml
# åŠ é€Ÿé“¾æ¥: https://cdn.jsdelivr.net/gh/TamperAcc/Clash@main/StashSystem.yaml
# Stash å…ƒæ•°æ®
name: "StashSystem.yaml v1.01"
desc: "v1.01 
icon: https://cdn.jsdelivr.net/gh/Orz-3/mini@master/Color/Stash.png
# ==========================================
# æ ¸å¿ƒç½‘ç»œè®¾ç½® (TCP/DNS/MitM/HTTP)
# ==========================================
# 1. TCP å¹¶å‘ & åŸºç¡€ä¼˜åŒ–
tcp-concurrent: true
keep-alive-interval: 30
ipv6: false        # ğŸš« å¼ºåˆ¶å…³é—­ IPv6 åè®®æ ˆ (è§£å†³ no route to host æŠ¥é”™)
prefer-ipv6: false # ğŸ“± iOS 5G ä¼˜åŒ–: å¼ºåˆ¶å…³é—­ IPv6 é˜²æ­¢ Google/YouTube å»¶è¿Ÿè¿‡é«˜
allow-lan: false   # ğŸ›¡ï¸ å®‰å…¨åŠ å›º: æ‰‹æœºç«¯é»˜è®¤å…³é—­å±€åŸŸç½‘å…±äº«ï¼Œé˜²æ­¢è¢«æ‰«æ
bind-address: "*"  # é…åˆ allow-lan: falseï¼Œæ­¤é¡¹ä»…åœ¨æœ¬æœºç”Ÿæ•ˆ
# 2. GeoData å†…å­˜ä¼˜åŒ–æ¨¡å¼
geodata-mode: true
geodata-loader: memconservative
geox-url:
  geoip: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.metadb"
  geosite: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat"
  mmdb: "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat"
# 3. æ¨¡æ‹ŸæŒ‡çº¹
global-client-fingerprint: chrome

# 4. DNS è®¾ç½®
dns:
  enable: true
  ipv6: false
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  respect-rules: true
  # ğŸš€ Bootstrap DNS: å¿…é¡»é…ç½®ï¼Œå¦åˆ™æ— æ³•è§£æ DoH åŸŸå
  default-nameserver:
    - 223.5.5.5
    - 1.12.12.12
  fake-ip-filter:
    - "*.lan"
    - "*.local"
    - "stun.*"
    - "time.*.apple.com"
    - "time1.cloud.tencent.com"
    - "*.bambulab.com"
    - "*.bambulab.cn"
    - "+.stun.*.*"
    - "+.stun.*"
    - "+.nintendo.net"
    - "+.playstation.net"
    - "+.xboxlive.com"
    - "+.msftconnecttest.com"
    - "+.msftncsi.com"
    # â¬‡ï¸ åŒæ­¥ Mihomo: è¡¥å…… NTP å’Œ åè®®ç›¸å…³è¿‡æ»¤
    - "+.ntp.org"
    - "+.pool.ntp.org"
    - "+.stun.protocol.org"
    - "time.*.com"
    - "time.*.gov"
    - "time.*.edu.cn"

  # ğŸš€ Main Nameservers (DoH é˜²åŠ«æŒ)
  nameserver:
    # é»˜è®¤èµ°é˜¿é‡Œ/è…¾è®¯ DoH (IP ç›´è¿ï¼Œæé€Ÿä¸”åŠ å¯†)
    - https://223.5.5.5/dns-query
    - https://1.12.12.12/dns-query
    
  # ğŸ›¡ï¸ ç­–ç•¥åˆ†æµ (è§£å†³ context deadline exceeded æŠ¥é”™)
  nameserver-policy:
    # Apple/iCloud æå…¶æ•æ„Ÿï¼Œå¼ºåˆ¶èµ° System (iOSç³»ç»ŸåŸç”ŸDNS) ä»¥æ¶ˆé™¤æŠ¥é”™
    # ä¼˜åŒ–: ä½¿ç”¨ geosite:apple ç»Ÿä¸€æ¥ç®¡æ‰€æœ‰ Apple æœåŠ¡ DNSï¼Œç¡®ä¿ CDN é€Ÿåº¦å’Œæ¨é€ç¨³å®š
    'geosite:apple': 'system'
    '+.crashlytics.com': 'system'
    # Bambu Lab ä¹Ÿå»ºè®®èµ° System ç¡®ä¿å±€åŸŸç½‘å‘ç°
    '+.bambulab.cn': 'system'
    '+.bambulab.com': 'system'
    # å›½å†… Geosite èµ°è…¾è®¯ UDP (å¿«)
    'geosite:cn': '119.29.29.29'

  fallback:
    # ç§»åŠ¨ç½‘ç»œä¸‹ï¼ŒFallback ä»…ä½œä¸º nameserver å½»åº•æŒ‚æ‰çš„å†·å¤‡
    - https://1.12.12.12/dns-query
    - https://223.5.5.5/dns-query
  
  fallback-filter:
    geoip: true
    geoip-code: CN
    ipcidr:
      - 240.0.0.0/4

# 4.1 Sniffer å—…æ¢ (iOS çœç”µä¼˜åŒ–)
# âš ï¸ æ³¨æ„: é™¤éå¿…é¡»ï¼Œå¦åˆ™å»ºè®®å…³é—­æˆ–ä»…ç‰¹å®šåè®®å¼€å¯ï¼Œä»¥é™ä½ CPU å”¤é†’
sniffer:
  enable: false  # ğŸ”‹ çœç”µä¼˜å…ˆã€‚è‹¥éœ€ç²¾ç¡®åˆ†æµç”±çº¯ IP è®¿é—®çš„åŸŸå(å¦‚ Spotify/Netflix)ï¼Œå¯åœ¨æ­¤å¼€å¯
  parse-pure-ip: true
  override-destination: true
  sniff:
    HTTP:
      ports: [80, 8080, 8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC: # v3.3.0+ æ”¯æŒ HTTP/3 å—…æ¢
      ports: [443, 8443]
# 5. MitM (HTTPS è§£å¯†)
mitm:
  enable: true
  append-system-trust: true
  hostname:
    - "*.google.cn"
    - "*.google.com.cn"
    - "www.google.com"
# 6. HTTP å¼•æ“
http:
  force-http-engine-hosts:
    - "*.google.cn"
    - "*.google.com.cn"
rewrite:
  - match: ^https?://(www\.)?google\.cn
    replace: https://www.google.com
    type: 302
  - match: ^https?://(www\.)?google\.com\.cn
    replace: https://www.google.com
    type: 302